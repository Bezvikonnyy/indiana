<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Details</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script>
        function deleteGame(gameId) {
            if (confirm("Вы уверены, что хотите удалить эту игру?")) {
                fetch(`/game/delete/${gameId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => {
                        if (response.ok) {
                            // Перенаправление на список игр после успешного удаления
                            window.location.href = '/home';
                        } else {
                            alert('Ошибка при удалении игры.');
                        }
                    })
                    .catch(error => {
                        alert('Произошла ошибка: ' + error);
                    });
            }
        }
    </script>
</head>
<body>
<header>
    <div style="display: flex; justify-content: space-between;">
        <h1 th:text="${game.title}">Название игры</h1>
        <div>
            <!-- Профиль и выход без дополнительной проверки, это уже контролируется Spring Security -->
            <a href="/profile">Профиль</a> | <a href="/logout">Выйти</a>
        </div>
    </div>
</header>

<main>
    <section>
        <h2>Описание</h2>
        <p th:text="${game.details}">О игре</p>

        <h3>Категории</h3>
        <ul>
            <li th:each="category : ${game.categories}" th:text="${category.title}">Категория</li>
        </ul>

        <h3>Изображение</h3>
        <img th:src="@{${game.imageUrl}}" alt="Game Image" style="max-width: 250px;">

        <h3>Файл игры</h3>
        <a th:href="@{'/' + ${game.gameFileUrl}}" download>Скачать игру</a>

        <div style="margin-top: 20px;">
            <!-- Кнопка редактирования -->
            <a th:href="@{'/game/edit/' + ${game.id}}">
                <button>Редактировать</button>
            </a>

            <!-- Кнопка для удаления игры -->
            <button th:onclick="'deleteGame(' + ${game.id} + ')'">Удалить</button>
        </div>

        <br/>
        <a href="/home">← Назад ко всем играм</a>
    </section>
</main>

<footer>
    <p>© 2025 Game Catalog</p>
</footer>
</body>
</html>
